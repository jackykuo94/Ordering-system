# è¨‚é¤ç³»çµ±è¨­è¨ˆèˆ‡å¯¦ç¾

##ä¸€ã€ç³»çµ±è¨­è¨ˆç›®æ¨™èˆ‡æ ¸å¿ƒç†å¿µ

æœ¬è¨‚é¤ç³»çµ±ä»¥ é«˜å¯æ“´å……æ€§ã€å¯ç¶­è­·æ€§ã€åˆ†å±¤è§£è€¦ã€çœŸå¯¦å•†æ¥­æƒ…å¢ƒ ç‚ºè¨­è¨ˆæ ¸å¿ƒï¼Œæ¨¡æ“¬å¯¦éš›å¤–é€å¹³å°æˆ–é¤å»³è¨‚é¤ç³»çµ±çš„å¾Œç«¯æ¶æ§‹ã€‚ç³»çµ±æ¡ç”¨ åˆ†å±¤æ¶æ§‹ï¼ˆLayered Architectureï¼‰ ä¸¦çµåˆ DDDï¼ˆDomain-Driven Designï¼‰ èˆ‡ äº‹ä»¶å°å‘ï¼ˆEvent-drivenï¼‰ çš„æ€æƒ³ï¼Œç¢ºä¿ç³»çµ±èƒ½æ‡‰ä»˜é«˜ä½µç™¼ã€åŠŸèƒ½æ¼”é€²èˆ‡å•†æ¥­è¦å‰‡è¤‡é›œåŒ–ã€‚

##äºŒã€æ•´é«”ç³»çµ±åˆ†å±¤æ¶æ§‹ï¼ˆå®è§€ï¼‰

åˆ†å±¤ç¸½è¦½

Presentation Layerï¼ˆè¡¨ç¤ºå±¤ / APIå±¤ï¼‰

Application Layerï¼ˆæ‡‰ç”¨å±¤ï¼‰

Domain Layerï¼ˆé ˜åŸŸå±¤ / å•†æ¥­æ ¸å¿ƒï¼‰

Infrastructure Layerï¼ˆåŸºç¤è¨­æ–½å±¤ï¼‰

External Servicesï¼ˆå¤–éƒ¨ç³»çµ±ï¼‰

Client
  â†“
API / Controller
  â†“
Application Service
  â†“
Domain Model
  â†“
Repository / Infrastructure
  â†“
Database / External Service

##ä¸‰ã€å„å±¤è©³ç´°è¨­è¨ˆèªªæ˜

1ï¸âƒ£ Presentation Layerï¼ˆè¡¨ç¤ºå±¤ï¼‰

è·è²¬

æ¥æ”¶ä½¿ç”¨è€…è«‹æ±‚ï¼ˆWeb / Appï¼‰

é©—è­‰è¼¸å…¥è³‡æ–™ï¼ˆDTO Validationï¼‰

å°‡è«‹æ±‚è½‰ç‚º Application Command

å›å‚³ Response DTO

ä¸»è¦å…ƒä»¶

Controller

Request DTO

Response DTO

ç‰¹é»

ä¸åŒ…å«ä»»ä½•å•†æ¥­é‚è¼¯

åƒ…è² è²¬ã€Œè³‡æ–™è½‰æ›èˆ‡æµç¨‹è½‰äº¤ã€

UMLï¼ˆè¡¨ç¤ºå±¤ï¼‰

@startuml
class OrderController {
  +createOrder(req)
  +getOrder(id)
}

class OrderRequestDTO
class OrderResponseDTO

OrderController --> OrderRequestDTO
OrderController --> OrderResponseDTO
@enduml

ğŸ“Œ é™„è¨»ï¼šController ä¸çŸ¥é“è¨‚å–®æ€éº¼è¨ˆåƒ¹ï¼ŒåªçŸ¥é“ã€Œè¦äº¤çµ¦ Application å±¤è™•ç†ã€ã€‚

2ï¸âƒ£ Application Layerï¼ˆæ‡‰ç”¨å±¤ï¼‰

è·è²¬

å”èª¿ç³»çµ±æµç¨‹ï¼ˆUse Caseï¼‰

æ§åˆ¶äº¤æ˜“ï¼ˆTransaction Boundaryï¼‰

å‘¼å« Domain ç‰©ä»¶

ç™¼ä½ˆ Domain Event

ä¸»è¦å…ƒä»¶

Application Service

Command / Query

Domain Event Publisher

UMLï¼ˆæ‡‰ç”¨å±¤ï¼‰

@startuml
class OrderApplicationService {
  +placeOrder(cmd)
  +cancelOrder(orderId)
}

class PlaceOrderCommand
class OrderPlacedEvent

OrderApplicationService --> PlaceOrderCommand
OrderApplicationService --> OrderPlacedEvent
@enduml

ğŸ“Œ é™„è¨»ï¼šApplication Service æ˜¯ã€Œæµç¨‹å°æ¼”ã€ï¼Œä½†ä¸æ˜¯ã€Œæ¼”å“¡ã€ã€‚

3ï¸âƒ£ Domain Layerï¼ˆé ˜åŸŸå±¤ï¼Œç³»çµ±æ ¸å¿ƒï¼‰

è·è²¬

å®šç¾©å•†æ¥­è¦å‰‡

ä¿è­‰è³‡æ–™èˆ‡ç‹€æ…‹çš„ä¸€è‡´æ€§

å°è£è¤‡é›œè¡Œç‚º

æ ¸å¿ƒæ¦‚å¿µ

Entityï¼šOrderã€Userã€Restaurant

Value Objectï¼šMoneyã€Address

Aggregate Rootï¼šOrder

Domain Serviceï¼šPricingService

Domain Eventï¼šOrderPaidã€OrderCancelled

UMLï¼ˆé ˜åŸŸæ¨¡å‹ï¼‰

@startuml
class Order {
  -id
  -status
  -items
  +pay()
  +cancel()
}

class OrderItem {
  -price
  -quantity
}

class Money {
  -amount
  -currency
}

Order "1" o-- "*" OrderItem
OrderItem --> Money
@enduml

ğŸ“Œ é™„è¨»ï¼š

Order æ˜¯ Aggregate Root

æ‰€æœ‰ OrderItem çš„è®Šå‹•éƒ½å¿…é ˆç¶“é Order

4ï¸âƒ£ Infrastructure Layerï¼ˆåŸºç¤è¨­æ–½å±¤ï¼‰

è·è²¬

æŠ€è¡“ç´°ç¯€å¯¦ç¾

è³‡æ–™åº«å­˜å–

å¤–éƒ¨ç³»çµ±æ•´åˆ

ä¸»è¦å…ƒä»¶

Repository Implementation

ORM / SQL

Message Queue Adapter

UMLï¼ˆåŸºç¤è¨­æ–½å±¤ï¼‰

@startuml
interface OrderRepository {
  +save(order)
  +findById(id)
}

class OrderRepositoryImpl
class MySQLDatabase

OrderRepository <|.. OrderRepositoryImpl
OrderRepositoryImpl --> MySQLDatabase
@enduml

ğŸ“Œ é™„è¨»ï¼šDomain åªä¾è³´ Repository ä»‹é¢ï¼Œä¸ä¾è³´è³‡æ–™åº«ã€‚

5ï¸âƒ£ å¤–éƒ¨ç³»çµ±æ•´åˆï¼ˆExternal Servicesï¼‰

å¯èƒ½æ•´åˆé …ç›®

é‡‘æµç³»çµ±ï¼ˆPayment Gatewayï¼‰

æ¨æ’­ç³»çµ±ï¼ˆNotificationï¼‰

ç¬¬ä¸‰æ–¹å¤–é€å¹³å°

UMLï¼ˆå¤–éƒ¨æ•´åˆï¼‰

@startuml
class PaymentServiceAdapter {
  +pay(order)
}

class ThirdPartyPaymentAPI

PaymentServiceAdapter --> ThirdPartyPaymentAPI
@enduml

ğŸ“Œ é™„è¨»ï¼šä½¿ç”¨ Adapter Patternï¼Œé¿å…ç¬¬ä¸‰æ–¹æ±¡æŸ“æ ¸å¿ƒç³»çµ±ã€‚

##å››ã€å®Œæ•´ç³»çµ± UML ç¸½è¦½ï¼ˆæ•´åˆï¼‰

@startuml
Client --> OrderController
OrderController --> OrderApplicationService
OrderApplicationService --> Order
OrderApplicationService --> OrderRepository
OrderRepository --> Database
OrderApplicationService --> PaymentServiceAdapter
@enduml

##äº”ã€è¨­è¨ˆå„ªé»ç¸½çµ

âœ… é«˜å…§èšã€ä½è€¦åˆ

âœ… å•†æ¥­é‚è¼¯é›†ä¸­æ–¼ Domain

âœ… æ˜“æ–¼æ¸¬è©¦ï¼ˆDomain å¯å–®å…ƒæ¸¬è©¦ï¼‰

âœ… å¯æ›¿æ›è³‡æ–™åº«èˆ‡å¤–éƒ¨æœå‹™

âœ… å¯æ¼”é€²ç‚ºå¾®æœå‹™æ¶æ§‹

##å…­ã€å¯å»¶ä¼¸é€²éšä¸»é¡Œï¼ˆå¯å†æ·±åŒ–ï¼‰

CQRS + Event Sourcing

å¾®æœå‹™æ‹†åˆ†ï¼ˆOrder / Payment / Deliveryï¼‰

Saga Patternï¼ˆè·¨æœå‹™äº¤æ˜“ï¼‰

é«˜ä½µç™¼ä¸‹çš„è¨‚å–®é–èˆ‡ä¸€è‡´æ€§
